import{_ as Y}from"./VPaginator.vue_vue_type_script_setup_true_lang-Bd_7zKZw.js";import{f as q,u as z,ag as G,h as s,D as $,C as H,G as K,o as r,c as l,a,v as _,H as D,q as b,F as W,i as J,A as O,b as n,t as g,j as Q,a4 as X,a6 as Z,a7 as ee,K as te,p as se,s as ae}from"./index-k-7ViVgn.js";import{s as oe}from"./index-Cfn63MK0.js";import{_ as ne}from"./ErrorMessage.vue_vue_type_script_setup_true_lang-B7HlNIPr.js";import{_ as ie}from"./PageLoader-COy97JVn.js";import{_ as re}from"./VCard.vue_vue_type_script_setup_true_lang-DiPn360S.js";import{s as le}from"./index-BHY7YUQw.js";import{_ as ce}from"./VNavbar.vue_vue_type_script_setup_true_lang-HfkB0Wd3.js";import{u as v}from"./index-HWEJQlsh.js";import"./helpers-BF5XYaOm.js";const de={key:0,class:"left-0 top-0 z-[100] fixed w-dvw h-dvh flex items-center justify-center bg-black/60 backdrop-blur-lg"},ue={class:"mt-2 flex flex-col w-full items-center justify-center gap-4"},me={key:2,class:"w-full mt-2"},pe={key:3,class:"mt-2 py-2 flex flex-col gap-2 *:flex-shrink-0 md:h-[calc(100dvh-8.5rem)] overflow-y-auto items-center"},fe={class:"flex items-center gap-1"},_e={class:"font-semibold"},ge={class:"text-sm whitespace-pre-wrap"},ve={class:"flex items-center gap-1 justify-between"},he={class:"flex items-center gap-2"},d=20,Ve=q({__name:"NotificationsView",setup(we){const u=O(),h=z(),S=G(),w=s(!1),m=s(null),c=s(0),N=$(()=>c.value*d),p=s(!1),i=s(null),C=$(()=>{const e=new URLSearchParams;return e.append("skip",N.value.toString()),e.append("limit",d.toString()),e.append("sort","createdAt,DESC"),e.append("where",`userId,${h.user.id}`),e.toString()}),y=async()=>{await v(`user/notifications?${C.value}`,{loading:w,error:m,allLoaded:p,config:{router:u}},e=>{p.value=e.data.length<d,i.value=e.data})};H(c,()=>y(),{immediate:!0});const L=s(!1),f=s(null),P=async e=>{e.loading=!0,await v(`user/notifications/${e.id}`,{loading:L,error:f,config:{router:u,method:"DELETE"}},()=>{i.value&&(i.value=i.value.filter(o=>o.id!==e.id))}),e.loading=!1,f.value&&S.add({severity:"error",summary:"Failed to delete Notification",detail:f.value.message,life:5e3})},x=s(!1),V=s(null),E=async()=>{await v(`user/notifications/?where=userId,${h.user.id}&where=isRead,false`,{loading:x,error:V,config:{router:u,method:"PUT",body:{data:{isRead:!0}}}})};return K(async()=>{i.value&&await E()}),(e,o)=>{const A=ce,B=le,k=re,R=ie,T=ne,U=te,I=se,M=oe,j=ae,F=Y;return r(),l("div",null,[a(A),x.value?(r(),l("div",de,[a(k,{header:"Updating",class:"w-60 shadow-lg"},{default:_(()=>[n("div",ue,[a(B,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"transparent",animationDuration:".5s","aria-label":"Custom ProgressSpinner"}),o[2]||(o[2]=n("p",{class:"text-mute font-semibold text-sm"},"Please wait...",-1))])]),_:1})])):D("",!0),w.value?(r(),b(R,{key:1})):m.value?(r(),l("div",me,[a(T,{error:m.value,request:"GET",onRetry:y},null,8,["error"])])):i.value?(r(),l("div",pe,[(r(!0),l(W,null,J(i.value,t=>(r(),b(k,{key:t.id,class:"w-full max-w-[32rem]"},{header:_(()=>[n("div",fe,[a(U,{prime:"",name:"info-circle"}),n("p",_e,g(t.title),1)])]),default:_(()=>[n("p",ge,g(t.description),1),a(I,{class:"py-1"}),n("div",ve,[n("small",null,g(Q(X)(t.createdAt,"MMM DD, YYYY hh:mm AA")),1),n("div",he,[Z(a(M,{value:"new",severity:"warn",class:"text-xs"},null,512),[[ee,!t.isRead]]),a(j,{onClick:ye=>P(t),loading:t.loading,size:"small",severity:"danger",rounded:"",text:"",icon:"pi pi-trash"},null,8,["onClick","loading"])])])]),_:2},1024))),128)),a(F,{allLoaded:p.value,rows:d,onPrev:o[0]||(o[0]=t=>c.value=t),onNext:o[1]||(o[1]=t=>c.value=t)},null,8,["allLoaded"])])):D("",!0)])}}});export{Ve as default};
