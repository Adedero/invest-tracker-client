import{_ as X}from"./VCard.vue_vue_type_script_setup_true_lang-PTAvzsv6.js";import{s as Y}from"./index-DUakjIpn.js";import{s as Z}from"./index-685tTtX5.js";import{s as ee}from"./index-DrOr8a5z.js";import{_ as te}from"./VFileUploader.vue_vue_type_script_setup_true_lang-DE0wHCVf.js";import{_ as ae}from"./ErrorMessage.vue_vue_type_script_setup_true_lang-IRMrSdrb.js";import{_ as se}from"./PageLoader-CVVMFRJU.js";import{_ as le}from"./VNavbar.vue_vue_type_script_setup_true_lang-aTOVxp6y.js";import{f as oe,ag as ne,h as d,C as ie,D as de,E as ue,o as m,c as f,a as i,v as b,b as a,q as P,k as r,F as me,i as re,H as R,L as ce,A as pe,t as L,s as ve}from"./index-CPQeoj50.js";import{u as j}from"./index-p30fdSMQ.js";import{s as fe}from"./helpers-BF5XYaOm.js";import{t as _e}from"./investment-tier-C6RGqzcN.js";import"./index-57mWwkce.js";import"./index-CyFKcpBt.js";const ge={class:"font-semibold text-primary-500 text-lg"},xe={class:"flex items-center gap-2"},be={class:"mt-2 md:h-[calc(100dvh-9rem)]"},Ve={key:2,class:"h-full w-full"},ye={class:"grid md:grid-cols-3 gap-4 h-full"},he={class:"md:col-span-1"},ke={class:"grid gap-2"},Ue={class:"bg-slate-200 dark:bg-slate-700 rounded-md h-60 overflow-hidden"},Ce=["src"],$e={class:"mt-2"},we={class:"grid gap-4"},De={class:"grid"},Te={class:"grid"},Pe={class:"md:col-span-2 h-full overflow-y-auto"},Re={key:0,class:"grid gap-4"},Ne={class:"flex items-center justify-between gap-3"},Ie={class:"text-mute font-semibold"},Se={class:"mt-2 grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-x-4 gap-y-6"},Ee={class:"grid relative"},ze={key:0,class:"text-red-500 absolute -bottom-5"},Fe={class:"grid"},Me={class:"grid"},Be={class:"grid"},Ae={class:"grid"},at=oe({__name:"InvestmentPlanManagerView",setup(Le){var M;const q=ce(),V=pe(),y=ne(),h=(M=q.params.investmentPlanId)==null?void 0:M.toString(),N=d(!1),k=d(null),e=d({}),U=d({}),I=d(""),G=d([..._e]);ie(()=>e.value.name,()=>{e.value.slug=fe(e.value.name)});const S=de(()=>{const{name:l,slug:t,image:o,tiers:u}=e.value;return!l||!t||!o||!(u!=null&&u.length)||u.some(({name:p,minimumDeposit:v,expectedReturnRate:D,duration:_,terminationFee:g})=>!p||!v||!D||!_||g===void 0||g===null)}),E=async()=>{await j(`admin/investment-plans/${h}`,{loading:N,error:k,config:{router:V,cache:!0}},l=>{e.value=l.data,U.value=l.data})},z=()=>{var l;e.value.tiers=(l=e.value.tiers)==null?void 0:l.sort((t,o)=>t.minimumDeposit-o.minimumDeposit)},C=d(!1),$=d(""),H=(l,t)=>{var o,u;(u=(o=e.value)==null?void 0:o.tiers)!=null&&u.some((p,v)=>p.name===l&&v!==t)?(C.value=!0,$.value=l):(C.value=!1,$.value="")},c=d(!1),w=d(null),F=async()=>{if(C.value){y.add({severity:"warn",summary:"Duplicate name found",detail:`A ${$.value} tier already exists.`,life:5e3});return}const l=e.value.id?`admin/investment-plans/${e.value.id}`:"admin/investment-plans",t=e.value.id?"PUT":"POST";if(z(),await j(l,{loading:c,error:w,config:{router:V,method:t,body:{data:e.value}}},o=>{if(!h){V.push({name:"admin-investment-plans"});return}y.add({severity:"success",summary:"Success",detail:"Investment plan updated successfully",life:3e3})}),w.value){y.add({severity:"error",summary:"Error",detail:w.value.message,life:6e3});return}},O=()=>{!e.value&&!U.value||(e.value={...U.value})},J=()=>{var l,t,o;e.value={...e.value,tiers:[{name:`Tier ${(((t=(l=e.value)==null?void 0:l.tiers)==null?void 0:t.length)??0)+1}`,minimumDeposit:0,duration:0,expectedReturnRate:0,terminationFee:0},...((o=e.value)==null?void 0:o.tiers)??[]]}},K=l=>{!e.value||!e.value.tiers||(e.value={...e.value,tiers:e.value.tiers.filter(t=>t!==l)})};return ue(async()=>{if(h){await E(),I.value=e.value.image??"",z();return}}),(l,t)=>{const o=ve,u=le,p=se,v=ae,D=te,_=ee,g=Z,x=Y,Q=X;return m(),f("div",null,[i(u,null,{left:b(()=>[a("p",ge,L(e.value.name??"New Investment Plan"),1)]),right:b(()=>[a("div",xe,[i(o,{onClick:J,label:"Add Tier",icon:"pi pi-plus",outlined:"",size:"small"}),i(o,{onClick:F,label:"Save",icon:"pi pi-save",size:"small",loading:c.value,disabled:c.value||S.value},null,8,["loading","disabled"]),i(o,{label:"Cancel",icon:"pi pi-times",severity:"secondary",size:"small",onClick:O})])]),_:1}),a("div",be,[N.value?(m(),P(p,{key:0})):k.value?(m(),P(v,{key:1,error:k.value,request:"GET",onRetry:E,closable:""},null,8,["error"])):e.value?(m(),f("div",Ve,[a("div",ye,[a("div",he,[a("div",ke,[a("div",Ue,[a("img",{src:e.value.image,class:"w-full h-full object-cover"},null,8,Ce)]),i(D,{size:"small",accept:"image/*","max-file-size":1*1024*1024,onSelect:t[0]||(t[0]=s=>e.value.image=s[0].dataUrl??""),onUpload:F,onCancel:t[1]||(t[1]=s=>e.value.image=I.value??""),class:"w-full",loading:c.value,disabled:c.value||S.value},null,8,["loading","disabled"])]),a("div",$e,[a("div",we,[a("div",De,[t[4]||(t[4]=a("label",{class:"text-mute text-sm font-semibold"},[r(" Name "),a("span",{class:"text-red-500"},"*")],-1)),i(_,{modelValue:e.value.name,"onUpdate:modelValue":t[2]||(t[2]=s=>e.value.name=s),modelModifiers:{trim:!0},fluid:""},null,8,["modelValue"])]),a("div",Te,[t[5]||(t[5]=a("label",{class:"text-mute text-sm font-semibold"},[r(" Slug "),a("span",{class:"text-red-500"},"*")],-1)),i(_,{modelValue:e.value.slug,"onUpdate:modelValue":t[3]||(t[3]=s=>e.value.slug=s),modelModifiers:{trim:!0},fluid:""},null,8,["modelValue"])])])])]),a("div",Pe,[e.value.tiers?(m(),f("div",Re,[(m(!0),f(me,null,re(e.value.tiers,(s,B)=>(m(),P(Q,{key:s.name,header:s.name},{header:b(()=>[a("div",Ne,[a("p",Ie,L(s.name),1),i(o,{onClick:T=>K(s),icon:"pi pi-trash",text:"",severity:"danger",rounded:"",size:"small"},null,8,["onClick"])])]),default:b(()=>{var T,A;return[a("div",Se,[a("div",Ee,[t[6]||(t[6]=a("label",{class:"text-mute text-sm font-semibold"},[r(" Name "),a("span",{class:"text-red-500"},"*")],-1)),i(g,{options:G.value,modelValue:s.name,"onUpdate:modelValue":n=>s.name=n,onChange:n=>H(n.value,B),fluid:""},null,8,["options","modelValue","onUpdate:modelValue","onChange"]),(A=(T=e.value)==null?void 0:T.tiers)!=null&&A.some((n,W)=>n.name===s.name&&W!==B)?(m(),f("small",ze," Duplicate name found ")):R("",!0)]),a("div",Fe,[t[7]||(t[7]=a("label",{class:"text-mute text-sm font-semibold"},[r(" Minimum Deposit "),a("span",{class:"text-red-500"},"*")],-1)),i(x,{modelValue:s.minimumDeposit,"onUpdate:modelValue":n=>s.minimumDeposit=n,prefix:"$","max-fraction-digits":2,fluid:""},null,8,["modelValue","onUpdate:modelValue"])]),a("div",Me,[t[8]||(t[8]=a("label",{class:"text-mute text-sm font-semibold"},[r(" Duration (days) "),a("span",{class:"text-red-500"},"*")],-1)),i(x,{modelValue:s.duration,"onUpdate:modelValue":n=>s.duration=n,fluid:""},null,8,["modelValue","onUpdate:modelValue"])]),a("div",Be,[t[9]||(t[9]=a("label",{class:"text-mute text-sm font-semibold"},[r(" Expected Return Rate "),a("span",{class:"text-red-500"},"*")],-1)),i(x,{modelValue:s.expectedReturnRate,"onUpdate:modelValue":n=>s.expectedReturnRate=n,suffix:"%","max-fraction-digits":2,fluid:""},null,8,["modelValue","onUpdate:modelValue"])]),a("div",Ae,[t[10]||(t[10]=a("label",{class:"text-mute text-sm font-semibold"},[r(" Termination Fee "),a("span",{class:"text-red-500"},"*")],-1)),i(x,{modelValue:s.terminationFee,"onUpdate:modelValue":n=>s.terminationFee=n,prefix:"$","max-fraction-digits":2,fluid:""},null,8,["modelValue","onUpdate:modelValue"])])])]}),_:2},1032,["header"]))),128))])):R("",!0)])])])):R("",!0)])])}}});export{at as default};
