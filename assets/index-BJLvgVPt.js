var S=Object.defineProperty;var R=(a,e,t)=>e in a?S(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var E=(a,e,t)=>R(a,typeof e!="symbol"?e+"":e,t);import{h as f,C as D,u as C,N as U,D as I}from"./index-rkqDWn-K.js";async function T(a,e,t){const s=f(!1),r=f(null),i=f(null),n=f(null),u=f(!1),l=e.timeout||60*1e3;let o=null;const m=async v=>{if(s.value)return;const w={},y=e.body?e.body instanceof FormData?e.body:JSON.stringify(e.body):null;if(y&&!(y instanceof FormData)&&(w["Content-Type"]="application/json"),e.withCredentials){const c=C().user.token;if(!c)throw new h({name:"InvalidAuthenticationTokenError",message:"Could not send request because an invalid access token was provided",status:401});w.Authorization=`Bearer ${c}`}const b=new AbortController,A=()=>b.abort();s.value=!0,u.value=!0,o=setTimeout(A,l);const q=`${e.baseUrl||"https://server.investtracker.live"}/${v.startsWith("/")?v.slice(1):v}`,F={method:e.method||"GET",headers:{...w,...e.headers},body:y,signal:b.signal};try{const d=await fetch(q,F),c=await d.json();if(n.value=d.status,u.value=!1,n.value>=400&&n.value<600)throw new h({message:c.message||"An error occurred.",name:c.errorName||"RequestError",status:n.value});i.value=c}catch(d){r.value=P(d,e.router)}finally{s.value=!1,o&&clearTimeout(o)}};return e.skip||await m(a),D(()=>a,async v=>{e.refetch&&await m(v)}),{_fetch:m,canAbort:u,data:i,error:r,loading:s,status:n}}const k=C(),p=U(new Map);async function M(a,e,t){if(e.withCredentials&&(!k.user.id||!k.user.token)){if(e.router){e.router.push({name:"login",query:{redirect:e.router.currentRoute.value.fullPath}});return}throw new h({name:"InvalidAuthenticationTokenError",message:"Could not send request because an invalid access token was provided",status:401})}e.revalidate??(e.revalidate=!0);const s=a,r=await T(a,{...e,skip:!0}),i=()=>{r.data.value!==null&&r.data.value!==void 0&&p.set(s,r.data.value)},n=()=>{p.delete(s)},u=async()=>{try{await r._fetch(a),i()}catch(o){console.error("Error fetching data:",o)}},l=I(()=>p.get(s));return l.value?(r.data.value=l.value,r.loading.value=!1,e.revalidate&&u()):await u(),{...r,_fetch:u,data:l,clearCache:n,loading:r.loading,error:r.error}}const j=async(a,{loading:e,error:t,success:s,allLoaded:r,config:i},n)=>{if(t.value=null,r!=null&&r.value)return null;e.value=!0,s&&(s.value=!1);const u=await O(a,i||{});if(!u)return e.value=!1,null;const{data:l,error:o}=u;return e.value=!1,o.value?(t.value=o.value,null):l.value?(s&&(s.value=!0),n&&await n(l.value),l.value):null},N={cache:!1,revalidate:!0,skip:!1,refetch:!1,withCredentials:!0,timeout:60*1e3,body:null,method:"GET",headers:{},router:null};async function O(a,e,t){return e={...N,...e},e.cache?await M(a,e,t):{...await T(a,e,t),clearCache:()=>{}}}class h extends Error{constructor(t){super(t.message);E(this,"status");this.name=t.name,this.status=t.status}}const P=(a,e)=>{if(!a)return null;if(!(a instanceof h))return new h({name:"RequestError",message:"Something went wrong. Please try again later.",status:500});const t=a;return t.status===401||t.status===403?(e==null||e.push({name:"login",query:{redirect:e.currentRoute.value.fullPath}}),null):t.status===404?(e==null||e.push({name:"error-404"}),a):t.name==="AbortError"?new h({name:"RequestTimeoutError",message:"That took too long. Check your internet connection and try again.",status:504}):(t.name==="ServerError"&&(e==null||e.push({name:"error-500"})),t)};export{h as F,j as u};
