import{f as N,h as c,E as D,o as h,c as L,a as e,v as t,L as M,A as O,l as T,O as U,q as A,k as b,t as F,H,b as a,j as d,B as K,s as Y,K as G}from"./index-CPQeoj50.js";import{s as J,a as Q,b as W,c as X,d as Z}from"./index-D8OBBn0D.js";import{s as ee}from"./index-BrlM22-N.js";import{_ as se}from"./OtpVerification.vue_vue_type_script_setup_true_lang-Y8b8F_z2.js";import{F as te,u as ae}from"./index-p30fdSMQ.js";import{z as P}from"./index-ans_9-if.js";import"./index-DrOr8a5z.js";import"./index-57mWwkce.js";import"./index-CyFKcpBt.js";import"./index-B0yKO5dZ.js";import"./ErrorMessage.vue_vue_type_script_setup_true_lang-IRMrSdrb.js";import"./helpers-BF5XYaOm.js";const oe={class:"w-full md:w-[26rem] h-full md:p-10 md:bg-white dark:bg-transparent"},re={class:"grid gap-1"},le={class:"flex pt-6 justify-between"},ne={class:"mt-2 flex flex-col items-center justify-center gap-2"},Se=N({__name:"PasswordRecoveryView",setup(ie){const r=M(),g=O(),x=atob((r.query.email??"").toString()),w=(r.query.userId??"").toString(),k=(r.query.token??"").toString(),V=(r.query.emailSubject??"").toString(),p=c(""),l=c(""),f=c(!1),_=c(!1),n=c(null),I=async()=>{n.value=null;const s=P.object({password:P.string({message:"Password is required"}).min(8,{message:"Password must be at least 8 characters long"})}).safeParse({password:l.value});if(!s.success){n.value=new te({message:s.error.errors[0].message,status:400,name:"ValidationError"});return}const o=`auth/password-reset?userId=${w}`,u=k?`${o}&token=${p.value}`:`${o}&otp=${p.value}`;await ae(u,{loading:_,error:n,config:{method:"POST",withCredentials:!1,router:g,body:{password:l.value}}},()=>{f.value=!0,localStorage.removeItem("user"),setTimeout(()=>{window.location.href="/auth/login"},3e3)})};return D(()=>{const{userId:v,email:s,token:o}=r.query;if(!v||!s&&!o){g.back();return}}),(v,s)=>{const o=T,u=Q,j=W,S=K,q=se,y=X,B=ee,$=Y,C=Z,E=J,R=G,z=U;return h(),L("div",oe,[e(o,{size:"24"}),e(E,{value:"1",linear:"",class:"dark:bg-transparent"},{default:t(()=>[e(j,null,{default:t(()=>[e(u,{value:"1"}),e(u,{value:"2"})]),_:1}),n.value?(h(),A(S,{key:0,size:"small",closable:"",severity:"error"},{default:t(()=>[b(F(n.value.message),1)]),_:1})):H("",!0),e(C,null,{default:t(()=>[e(y,{value:"1",class:"dark:bg-transparent"},{default:t(({activateCallback:i})=>[a("div",null,[e(q,{"page-title":"Password Recovery",email:d(x),userId:d(w),token:d(k),onSubmit:m=>{p.value=m,i("2")},emailSubject:d(V)},null,8,["email","userId","token","onSubmit","emailSubject"])])]),_:1}),e(y,{value:"2",class:"dark:bg-transparent"},{default:t(({activateCallback:i})=>[a("div",null,[a("div",re,[s[2]||(s[2]=a("label",{for:"password",class:"text-mute text-sm font-semibold"}," Enter your new password ",-1)),e(B,{modelValue:l.value,"onUpdate:modelValue":s[0]||(s[0]=m=>l.value=m),modelModifiers:{trim:!0},"toggle-mask":"",fluid:"","input-class":"dark:bg-slate-800"},null,8,["modelValue"])])]),a("div",le,[e($,{label:"Back",severity:"secondary",icon:"pi pi-arrow-left",onClick:m=>i("1")},null,8,["onClick"]),e($,{label:"Submit",onClick:I,loading:_.value,disabled:_.value||!l.value},null,8,["loading","disabled"])])]),_:1})]),_:1})]),_:1}),e(z,{visible:f.value,"onUpdate:visible":s[1]||(s[1]=i=>f.value=i),header:"Password Reset",modal:"",closable:!1,class:"w-80"},{default:t(()=>[a("div",ne,[e(R,{prime:"",name:"check-circle",class:"text-green-500",size:"35"}),e(S,{severity:"success"},{default:t(()=>s[3]||(s[3]=[a("p",{class:"text-center"},[b(" Your password has been successfully reset. "),a("br"),b(" Please, wait... ")],-1)])),_:1})])]),_:1},8,["visible"])])}}});export{Se as default};
