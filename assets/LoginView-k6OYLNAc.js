import{z as N,s as z}from"./index-Cw1MDNmN.js";import{h as g,u as I,f as j,N as A,o as l,c as u,a as o,b as a,k as m,v as c,q as D,H as p,j as F,l as O,r as T,A as U,t as V,s as $}from"./index-rkqDWn-K.js";import{s as H}from"./index-C0j1alk6.js";import{s as M}from"./index-DMxJWgcx.js";import{_ as G}from"./ErrorMessage.vue_vue_type_script_setup_true_lang-BkdBNGI_.js";import{z as f}from"./index-ans_9-if.js";import{u as J}from"./index-BJLvgVPt.js";import"./index-BZ2gPtDN.js";import"./index-Bv-llqAV.js";const K=g(N(f.object({email:f.string({message:"Email is required"}).email({message:"Please enter a valid email address"}).trim(),password:f.string({message:"Password is required"}).min(8,{message:"Password must be at least 8 characters long"}).trim()}))),Q=(r,s)=>{if(r.isEmailVerified===!1){s.push({name:"email-verification",query:{userId:r.id,email:btoa(r.email)}});return}I().user={...r,isLoggedIn:!0};const{redirect:t}=s.currentRoute.value.query;switch(r.role){case"admin":if(t&&typeof t=="string"&&t.includes("admin")){s.push(t);return}s.push({name:"admin-dashboard"});break;case"user":if(t&&typeof t=="string"){s.push(t);return}s.push({name:"dashboard"});break;default:s.push({name:"login"});break}},W={class:"w-full md:w-[26rem] h-full md:p-10 md:bg-white dark:bg-transparent"},X={class:"mt-8"},Y={class:"mt-2 text-sm text-mute"},Z={class:"mt-5 w-full"},ee={class:"flex flex-col gap-1"},se={key:0,class:"font-medium text-red-500"},te={class:"flex flex-col gap-1"},ae={key:0,class:"font-medium text-red-500"},oe={class:"flex justify-end"},fe=j({__name:"LoginView",setup(r){const s=U(),t=A({email:"",password:""}),_=g(!1),d=g(null),B=async i=>{await J("auth/login",{loading:_,error:d,config:{method:"POST",withCredentials:!1,body:i,router:s}},e=>{Q(e.user,s)})},L=({valid:i,values:e})=>{i&&B(e)};return(i,e)=>{const P=O,x=T("RouterLink"),R=G,S=M,q=H,C=$,E=z;return l(),u("div",W,[o(P,{size:"24"}),a("header",X,[e[3]||(e[3]=a("h1",{class:"text-3xl md:text-4xl font-semibold"},"Log In",-1)),a("p",Y,[e[1]||(e[1]=m(" Don't have an account yet? ")),o(x,{to:{name:"register"},class:"text-primary-500 font-semibold hover:underline"},{default:c(()=>e[0]||(e[0]=[m(" Register ")])),_:1}),e[2]||(e[2]=m(". "))])]),d.value?(l(),D(R,{key:0,error:d.value,class:"mt-3"},null,8,["error"])):p("",!0),a("div",Z,[o(E,{initialValues:t,resolver:F(K),validateOnValueUpdate:!0,validateOnBlur:!0,onSubmit:L,class:"flex flex-col gap-4 w-full"},{default:c(n=>{var v,b,w,h,y,k;return[a("div",ee,[e[4]||(e[4]=a("label",{for:"email",class:"text-mute text-sm"},"Email Address",-1)),o(S,{id:"email",name:"email",type:"email",fluid:""}),(v=n.email)!=null&&v.invalid?(l(),u("small",se,V((w=(b=n.email)==null?void 0:b.error)==null?void 0:w.message),1)):p("",!0)]),a("div",te,[e[5]||(e[5]=a("label",{for:"password",class:"text-mute text-sm"},"Password",-1)),o(q,{"input-id":"password",name:"password",fluid:"","toggle-mask":"",feedback:!1}),(h=n.password)!=null&&h.invalid?(l(),u("small",ae,V((k=(y=n.password)==null?void 0:y.error)==null?void 0:k.message),1)):p("",!0)]),a("div",oe,[o(x,{to:{name:"forgot-password"},class:"text-sm text-primary-500 font-semibold hover:underline"},{default:c(()=>e[6]||(e[6]=[m(" Forgot password? ")])),_:1})]),o(C,{loading:_.value,type:"submit",label:"Submit",icon:"pi pi-sign-in"},null,8,["loading"])]}),_:1},8,["initialValues","resolver"])])])}}});export{fe as default};
