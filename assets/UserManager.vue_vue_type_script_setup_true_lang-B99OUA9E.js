import{f as Y,h as p,A as Z,ag as h,D as _,o as r,c as d,b as l,I as ee,a,v as se,q as le,k as g,t as x,H as y,j as te,s as ae,K as oe,p as ie,O as re}from"./index-BeBYLbm4.js";import{s as ue}from"./index-KYbbszim.js";import{s as de}from"./index-nFlc9OXx.js";import{s as ne}from"./index-Bgf8OROJ.js";import{s as me}from"./index-BJYIcNqT.js";import{u as fe}from"./index-CODlRzTV.js";import{_ as ve}from"./VFileUploader.vue_vue_type_script_setup_true_lang-CNL7LxJy.js";import{c as ce}from"./country-by-name-Di7sd6fA.js";import{z as U}from"./index-ans_9-if.js";const pe={class:"grid gap-4"},ge={class:"flex flex-col items-center justify-center gap-1"},xe={class:"w-24 aspect-square overflow-hidden rounded-full"},Ve=["src"],be={class:"grid"},we={key:0,class:"grid"},ye={class:"text-xs text-red-500"},Ue={key:1,class:"grid"},ke={class:"text-xs text-red-500"},Ee={class:"grid"},$e={key:0,class:"text-xs text-mute"},Ne={key:1,class:"text-xs text-mute"},Se={key:0,class:"mt-1 text-red-500 text-xs"},Pe={class:"grid"},Ce={class:"grid"},Be={class:"grid"},Ie={class:"grid mt-3"},Le=Y({__name:"UserManager",props:{user:{},role:{default:"user"}},emits:["done"],setup(i,{emit:F}){const K=F,V=p(!1),G=Z(),k=h(),s=p(i.user?{...i.user}:{password:"00000000",isEmailVerified:!1,role:i.role}),n=p(!1),b=p(null),u=p();async function E(){var m;u.value=void 0;const o=i.user?`admin/users/${(m=i.user)==null?void 0:m.id}`:"admin/users",e=i.user?"PUT":"POST";if(delete s.value.account,!i.user){const f=U.object({email:U.string({message:"Email is required"}).email({message:"Enter a valid email"}),password:U.string({message:"Password is required"}).min(8,{message:"Password must be at least 6 characters"})});if(u.value=f.safeParse({email:s.value.email,password:s.value.password}),!u.value.success)return}if(await fe(o,{loading:n,error:b,config:{router:G,method:e,body:{data:s.value}}},f=>{k.add({severity:"success",summary:"Done",detail:i.user?"User updated successfully":"New user created",life:3e3}),V.value=!1;const w=i.user?s.value:f.data;K("done",w)}),b.value){k.add({severity:"error",summary:"Failed",detail:b.value.message,life:6e3});return}}const $=_(()=>!s.value.name||!s.value.email||!s.value.role||!i.user&&(!s.value.password||s.value.password.length<8)),J=()=>{s.value={...i.user}};return(o,e)=>{const m=ae,f=oe,w=ie,v=me,Q=ne,W=de,N=ue,X=re;return r(),d("div",null,[l("div",{onClick:e[0]||(e[0]=c=>V.value=!0),class:"cursor-pointer"},[ee(o.$slots,"default",{},()=>[a(m,{label:"Edit Info",icon:"pi pi-user-edit",size:"small"})])]),a(X,{visible:V.value,"onUpdate:visible":e[12]||(e[12]=c=>V.value=c),modal:"",header:o.user?"Edit User":"New User",class:"w-80 md:w-96",onHide:J},{default:se(()=>{var c,S,P,C,B,I,M,z,D,T,j,q,A,R,H,L;return[l("div",pe,[l("div",ge,[l("div",xe,[s.value.image?(r(),d("img",{key:0,src:s.value.image,class:"w-full h-full object-cover"},null,8,Ve)):(r(),le(f,{key:1,name:"account_circle",size:"6rem",class:"text-primary-500"}))]),a(ve,{size:"small",accept:"image/*","max-file-size":1*1024*1024,onSelect:e[1]||(e[1]=t=>s.value.image=t[0].dataUrl??""),onUpload:E,onCancel:e[2]||(e[2]=t=>{var O;return s.value.image=((O=o.user)==null?void 0:O.image)??""}),class:"w-full",loading:n.value,disabled:n.value||$.value},null,8,["loading","disabled"])]),a(w),l("div",be,[e[13]||(e[13]=l("label",{class:"text-mute text-sm font-medium"},[g(" Name "),l("span",{class:"text-red-500"},"*")],-1)),a(v,{modelValue:s.value.name,"onUpdate:modelValue":e[3]||(e[3]=t=>s.value.name=t),modelModifiers:{trim:!0},fluid:""},null,8,["modelValue"])]),o.user?y("",!0):(r(),d("div",we,[e[14]||(e[14]=l("label",{class:"text-mute text-sm font-medium"},[g(" Email "),l("span",{class:"text-red-500"},"*")],-1)),a(v,{modelValue:s.value.email,"onUpdate:modelValue":e[4]||(e[4]=t=>s.value.email=t),modelModifiers:{trim:!0},fluid:"",invalid:!!((C=(P=(S=(c=u.value)==null?void 0:c.error)==null?void 0:S.flatten())==null?void 0:P.fieldErrors.email)!=null&&C[0])},null,8,["modelValue","invalid"]),l("p",ye,x((z=(M=(I=(B=u.value)==null?void 0:B.error)==null?void 0:I.flatten())==null?void 0:M.fieldErrors.email)==null?void 0:z[0]),1)])),o.user?y("",!0):(r(),d("div",Ue,[e[15]||(e[15]=l("label",{class:"text-mute text-sm font-medium"},[g(" Password "),l("span",{class:"text-red-500"},"*")],-1)),a(Q,{modelValue:s.value.password,"onUpdate:modelValue":e[5]||(e[5]=t=>s.value.password=t),modelModifiers:{trim:!0},fluid:"","toggle-mask":"",invalid:!!((q=(j=(T=(D=u.value)==null?void 0:D.error)==null?void 0:T.flatten())==null?void 0:j.fieldErrors.password)!=null&&q[0])},null,8,["modelValue","invalid"]),l("p",ke,x((L=(H=(R=(A=u.value)==null?void 0:A.error)==null?void 0:R.flatten())==null?void 0:H.fieldErrors.password)==null?void 0:L[0]),1),e[16]||(e[16]=l("p",{class:"text-xs text-mute"},"Password is automatically set to '00000000' (8 zeros)",-1))])),l("div",Ee,[e[17]||(e[17]=l("label",{class:"text-mute text-sm font-medium"},[g(" Account Verification Status "),l("span",{class:"text-red-500"},"*")],-1)),a(W,{modelValue:s.value.isEmailVerified,"onUpdate:modelValue":e[6]||(e[6]=t=>s.value.isEmailVerified=t),onLabel:"Verified",offLabel:"Not Verified"},null,8,["modelValue"]),o.user?(r(),d("p",$e,x(o.user.isEmailVerified?"User's account is already verified. If set as 'not verified', the user will need to verify their account again to log in.":"User's account is not verified. If set as 'verified', the user will not receive an email to verify their account."),1)):(r(),d("p",Ne," If set as 'verified', the user will not receive an email to verify their account. "))]),l("div",null,[e[18]||(e[18]=l("label",{class:"text-mute text-sm font-medium"},[g(" Role "),l("span",{class:"text-red-500"},"*")],-1)),a(N,{modelValue:s.value.role,"onUpdate:modelValue":e[7]||(e[7]=t=>s.value.role=t),options:["user","admin"],placeholder:"Select a role",class:"w-full"},null,8,["modelValue"]),o.user&&o.user.role!==s.value.role?(r(),d("p",Se," Role changed from "+x(o.user.role)+" to "+x(s.value.role)+". Be sure of this action before proceeding. ",1)):y("",!0)]),l("div",Pe,[e[19]||(e[19]=l("label",{class:"text-mute text-sm font-medium"},"Phone Number ",-1)),a(v,{modelValue:s.value.phoneNumber,"onUpdate:modelValue":e[8]||(e[8]=t=>s.value.phoneNumber=t),modelModifiers:{trim:!0},fluid:""},null,8,["modelValue"])]),l("div",Ce,[e[20]||(e[20]=l("label",{class:"text-mute text-sm font-medium"},"Address",-1)),a(v,{modelValue:s.value.address,"onUpdate:modelValue":e[9]||(e[9]=t=>s.value.address=t),modelModifiers:{trim:!0},fluid:""},null,8,["modelValue"])]),l("div",null,[e[21]||(e[21]=l("label",{class:"text-mute text-sm font-medium"},"Country",-1)),a(N,{"default-value":s.value.country?{country:s.value.country}:void 0,options:te(ce),editable:"","option-label":"country",fluid:"","show-clear":"",onValueChange:e[10]||(e[10]=t=>s.value.country=(t==null?void 0:t.country)??"")},null,8,["default-value","options"])]),l("div",Be,[e[22]||(e[22]=l("label",{class:"text-mute text-sm font-medium"},"State/Region",-1)),a(v,{modelValue:s.value.region,"onUpdate:modelValue":e[11]||(e[11]=t=>s.value.region=t),modelModifiers:{trim:!0},fluid:""},null,8,["modelValue"])]),l("div",Ie,[a(m,{onClick:E,loading:n.value,disabled:n.value||$.value,label:"Submit",icon:"pi pi-check-circle",fluid:""},null,8,["loading","disabled"])])])]}),_:1},8,["visible","header"])])}}});export{Le as _};
